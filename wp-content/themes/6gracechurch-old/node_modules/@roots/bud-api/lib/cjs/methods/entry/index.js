"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.entry = void 0;
const bud_support_1 = require("@roots/bud-support");
const lodash_1 = require("lodash");
const globAssets_1 = require("./globAssets");
const util_1 = require("./util");
const { isString } = bud_support_1.lodash;
const entry = async function (...input) {
    const app = this;
    if (input.length > 1 && !isString(input[0])) {
        app.error('the first parameter in a multi-parameter call to bud.entry must be a string');
        return app;
    }
    if ((input.length == 1 && isString(input[0])) || (0, lodash_1.isArray)(input[0])) {
        input = ['default', input[0]];
    }
    const normal = isString(input[0])
        ? (0, util_1.makeEntry)(input[0], input[1])
        : Object.entries(input[0]).reduce(util_1.reduceEntry, {});
    const records = await (0, util_1.applyToImports)(normal, async (request) => (0, util_1.isGlobular)(request) ? await globAssets_1.globAssets.bind(this)(request) : request);
    app.hooks.on('build.entry', a => records.reduce((a, [k, v]) => ({ ...a, [k]: v }), a));
    return app;
};
exports.entry = entry;
