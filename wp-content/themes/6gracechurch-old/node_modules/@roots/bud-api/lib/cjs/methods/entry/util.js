"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.applyToImports = exports.makeEntry = exports.reduceEntry = exports.isGlobular = void 0;
const bud_support_1 = require("@roots/bud-support");
const { isArray, isString } = bud_support_1.lodash;
/**
 * @internal
 */
const makeArray = v => isString(v) ? [v] : v;
/**
 * @internal
 */
const normalEntry = (entry) => {
    return isString(entry) || isArray(entry)
        ? { import: makeArray(entry) }
        : { ...(entry ?? {}), import: makeArray(entry.import) };
};
/**
 * @public
 */
const isGlobular = (str) => ['*', '{', '}', ','].filter(c => str.includes(c))?.length > 0;
exports.isGlobular = isGlobular;
/**
 * @public
 */
const reduceEntry = (a, [k, v]) => ({ ...a, [k]: normalEntry(v) });
exports.reduceEntry = reduceEntry;
/**
 * @public
 */
const makeEntry = (k, v) => ({
    [k]: normalEntry(v),
});
exports.makeEntry = makeEntry;
/**
 * @public
 */
const applyToImports = async (value, fn) => await Promise.all(Object.entries(value).map(async ([k, v]) => {
    v.import = (await Promise.all(v.import.map(fn))).flat();
    return [k, v];
}));
exports.applyToImports = applyToImports;
