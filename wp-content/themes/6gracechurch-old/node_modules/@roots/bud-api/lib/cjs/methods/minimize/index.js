"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.minimize = void 0;
const bud_support_1 = require("@roots/bud-support");
const css_minimizer_webpack_plugin_1 = __importDefault(require("css-minimizer-webpack-plugin"));
const minimize_constants_1 = require("./minimize.constants");
const { isUndefined } = bud_support_1.lodash;
/**
 * Enables minification of built assets.
 *
 * @example
 * Enable:
 *
 * ```js
 * bud.minimize()
 * ```
 *
 * @example
 * Explicitly disable:
 *
 * ```js
 * bud.minimize(false)
 * ```
 *
 * @example
 * Explicitly enable:
 *
 * ```js
 * bud.minimize(true)
 * ```
 *
 * @public
 */
const minimize = function (input, options) {
    const app = this;
    if (input === false) {
        app.hooks.on('build.optimization.minimize', false);
    }
    if (isUndefined(input) || input === true) {
        app.hooks.on('build.optimization.minimize', true);
    }
    app.hooks.on('build.optimization.minimizer', minimizer => {
        return [
            ...(minimizer ?? []),
            new css_minimizer_webpack_plugin_1.default({
                ...minimize_constants_1.cssMinimizerOptions,
                ...(options?.css ?? {}),
            }),
        ];
    });
    return app;
};
exports.minimize = minimize;
